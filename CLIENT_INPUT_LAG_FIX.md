# ν΄λΌμ΄μ–ΈνΈ μ΅°μ‘κ° κ°μ„  (Client-Side Prediction)

## λ¬Έμ  μ¦μƒ
- β… νΈμ¤νΈλ” μ΅°μ‘κ°μ΄ λ¶€λ“λ½κ³  μ¦‰κ°μ 
- β ν΄λΌμ΄μ–ΈνΈλ” μ…λ ¥ μ§€μ—°μ΄ μ‹¬ν•κ³  λ²„λ²…κ±°λ¦Ό
- β ν‚¤λ¥Ό λλ¬λ„ μΊλ¦­ν„°κ°€ λ¦κ² λ°μ‘

---

## λ¬Έμ  μ›μΈ

### μ΄μ „ λ°©μ‹: ServerAuthority (μ„λ²„ κ¶ν•)

```
ν΄λΌμ΄μ–ΈνΈ μ…λ ¥ β†’ μ„λ²„λ΅ μ „μ†΅ (μ§€μ—° 50~100ms)
                      β†“
                  μ„λ²„κ°€ μ²λ¦¬
                      β†“
              NetworkTransform λ™κΈ°ν™” (μ§€μ—° 50~100ms)
                      β†“
              ν΄λΌμ΄μ–ΈνΈκ°€ μ›€μ§μ„

μ΄ μ§€μ—°: 100~200ms μ΄μƒ
```

**νΈμ¤νΈλ” μ™ κ΄μ°®μ•λ‚?**
- νΈμ¤νΈλ” ν΄λΌμ΄μ–ΈνΈμ΄λ©΄μ„ λ™μ‹μ— μ„λ²„
- μ„λ²„ λ΅μ§μ΄ λ΅μ»¬μ—μ„ μ¦‰μ‹ μ‹¤ν–‰λλ―€λ΅ μ§€μ—° μ—†μ

---

## ν•΄κ²° λ°©λ²•: Client-Side Prediction (ν΄λΌμ΄μ–ΈνΈ μμΈ΅)

### μƒλ΅μ΄ λ°©μ‹

```
ν΄λΌμ΄μ–ΈνΈ μ…λ ¥ β†’ μ¦‰μ‹ λ΅μ»¬μ—μ„ μ›€μ§μ„ μ μ© (μ§€μ—° 0ms)
      β†“
μ„λ²„λ΅ μ „μ†΅ (λ°±κ·ΈλΌμ΄λ“)
      β†“
μ„λ²„κ°€ κ²€μ¦ λ° μ²λ¦¬
      β†“
NetworkTransformμ΄ ν•„μ”μ‹ μ„μΉ λ³΄μ •
```

**μ¥μ :**
- β… ν΄λΌμ΄μ–ΈνΈκ°€ μ¦‰μ‹ λ°μ‘ (νΈμ¤νΈμ™€ λ™μΌν• μ΅°μ‘κ°)
- β… μ„λ²„λ” μ—¬μ „ν μµμΆ… κ¶ν• λ³΄μ  (μΉνΈ λ°©μ§€)
- β… NetworkTransformμ΄ μλ™μΌλ΅ μ¤μ°¨ λ³΄μ •

---

## μ½”λ“ λ³€κ²½ λ‚΄μ©

### NetworkPlayerController2D.cs - FixedUpdate()

#### λ³€κ²½ μ „:
```csharp
if (IsOwner)
{
    // μ…λ ¥λ§ μ„λ²„λ΅ μ „μ†΅
    SetMoveInputServerRpc(move);
}

if (IsServer)
{
    // μ„λ²„λ§ μ›€μ§μ„ μ²λ¦¬
    _rb.linearVelocity = _serverMoveInput * actualMoveSpeed;
}
```

#### λ³€κ²½ ν›„:
```csharp
if (IsOwner)
{
    // ν΄λΌμ΄μ–ΈνΈκ°€ μ¦‰μ‹ μ›€μ§μ„ μ μ© (μμΈ΅)
    _rb.linearVelocity = move * actualMoveSpeed;

    // λ™μ‹μ— μ„λ²„λ΅ μ…λ ¥ μ „μ†΅
    SetMoveInputServerRpc(move);
}

if (IsServer && !IsOwner)
{
    // μ„λ²„λ” λ‹¤λ¥Έ ν΄λΌμ΄μ–ΈνΈ μ›€μ§μ„λ§ μ²λ¦¬
    _rb.linearVelocity = _serverMoveInput * actualMoveSpeed;
}
```

---

## κΈ°μ  μ„¤λ…

### Client-Side Predictionμ΄λ€?

1. **μμΈ΅ (Prediction)**
   - ν΄λΌμ΄μ–ΈνΈκ°€ μμ‹ μ μ…λ ¥μ„ μ¦‰μ‹ λ΅μ»¬μ—μ„ μ²λ¦¬
   - μ‚¬μ©μλ” μ§€μ—° μ—†μ΄ μΊλ¦­ν„°κ°€ μ›€μ§μ΄λ” κ²ƒμ„ λ΄„

2. **κ²€μ¦ (Validation)**
   - λ™μ‹μ— μ„λ²„λ΅ μ…λ ¥ μ „μ†΅
   - μ„λ²„κ°€ μ…λ ¥μ„ κ²€μ¦ν•κ³  κ³µμ‹ μ„μΉ κ³„μ‚°

3. **μ΅°μ • (Reconciliation)**
   - NetworkTransformμ΄ μ„λ²„ μ„μΉμ™€ ν΄λΌμ΄μ–ΈνΈ μ„μΉ λΉ„κµ
   - μ°¨μ΄κ°€ μμΌλ©΄ λ¶€λ“λ½κ² λ³΄μ • (Interpolation)

### μ™ μ•μ „ν•κ°€?

- **μ„λ²„κ°€ μ—¬μ „ν μµμΆ… κ¶ν• λ³΄μ **
  - ν΄λΌμ΄μ–ΈνΈκ°€ μΉνΈλ΅ λΉ λ¥΄κ² μ›€μ§μ—¬λ„
  - μ„λ²„λ” μ •μƒ μ†λ„λ§ μΈμ •
  - NetworkTransformμ΄ ν΄λΌμ΄μ–ΈνΈλ¥Ό μ¬λ°”λ¥Έ μ„μΉλ΅ λ³΄μ •

- **λ‹¤λ¥Έ ν”λ μ΄μ–΄λ” μ„λ²„ κ¶ν•μΌλ΅ λ™κΈ°ν™”**
  - λ‚΄ μΊλ¦­ν„°λ§ μ¦‰μ‹ λ°μ‘
  - λ‹¤λ¥Έ ν”λ μ΄μ–΄λ” μ„λ²„μ—μ„ λ°›μ€ μ„μΉλ΅ ν‘μ‹
  - λ„¤νΈμ›ν¬ μ§€μ—°μ€ λ³΄κ°„(Interpolation)μΌλ΅ λ¶€λ“λ½κ² μ²λ¦¬

---

## ν…μ¤νΈ λ°©λ²•

### 1. λΉλ“λ΅ ν…μ¤νΈ (κ¶μ¥)
```
1. File β†’ Build Settings β†’ Build
2. λΉλ“ νμΌ 2κ° μ‹¤ν–‰
   - μ²« λ²μ§Έ: Host
   - λ‘ λ²μ§Έ: Client
3. μ–‘μ½ λ¨λ‘ WASDλ΅ μ›€μ§μ—¬λ³΄κΈ°
```

### 2. Multiplayer Play Mode μ‚¬μ©
```
1. Window β†’ Multiplayer Play Mode
2. Enable Multiplayer Play Mode μ²΄ν¬
3. Virtual Players = 2
4. Play λ²„νΌ ν΄λ¦­
```

### ν™•μΈ μ‚¬ν•­
- [ ] ν΄λΌμ΄μ–ΈνΈκ°€ ν‚¤ μ…λ ¥μ— μ¦‰μ‹ λ°μ‘ν•λ”κ°€?
- [ ] νΈμ¤νΈμ™€ ν΄λΌμ΄μ–ΈνΈμ μ΅°μ‘κ°μ΄ λΉ„μ·ν•κ°€?
- [ ] λ²„λ²…κ±°λ¦Όμ΄λ‚ μ‹¬ν• μ§€μ—°μ΄ μ—†λ”κ°€?

---

## μ¶”κ°€ μµμ ν™” μµμ…

### NetworkTransform μ„¤μ • μ΅°μ •

PlayerNet Prefabμ NetworkTransformμ—μ„:

1. **Interpolate: true** (ν„μ¬ μ„¤μ •)
   - μ„μΉ λ³€ν™”λ¥Ό λ¶€λ“λ½κ² λ³΄κ°„
   - κ¶μ¥ μ μ§€

2. **PositionThreshold: 0.001** (ν„μ¬ μ„¤μ •)
   - μ„μΉ μ°¨μ΄κ°€ 0.001 μ΄μƒμΌ λ•λ§ λ™κΈ°ν™”
   - ν•„μ”μ‹ 0.01λ΅ μ¦κ°€ (λ€μ—­ν­ μ μ•½)

3. **UseUnreliableDeltas: trueλ΅ λ³€κ²½ κ°€λ¥**
   - UDPμ²λΌ λΉ λ¥΄μ§€λ§ ν¨ν‚· μ†μ‹¤ κ°€λ¥
   - μ›€μ§μ„μ²λΌ μμ£Ό μ—…λ°μ΄νΈλλ” λ°μ΄ν„°μ— μ ν•©

---

## νΈλ¬λΈ”μν…

### λ¬Έμ : ν΄λΌμ΄μ–ΈνΈκ°€ μκ°„μ΄λ™ν•κ±°λ‚ λ–¨λ¦Ό

**μ›μΈ:** ν΄λΌμ΄μ–ΈνΈ μμΈ΅κ³Ό μ„λ²„ κ²°κ³Όμ μ°¨μ΄κ°€ νΌ

**ν•΄κ²°:**
1. NetworkTransformμ **Interpolation ν™μ„±ν™”** ν™•μΈ
2. **PositionLerpSmoothing** κ°’ μ΅°μ • (κΈ°λ³Έ 1)
3. μ„λ²„ ν‹±λ μ΄νΈ ν™•μΈ (NetworkManager β†’ Tick Rate)

### λ¬Έμ : μ—¬μ „ν μ§€μ—°μ΄ λκ»΄μ§

**μ›μΈ:** λ„¤νΈμ›ν¬ μ§€μ—°μ΄ κ³Όλ„ν•κ² λ†’μ

**ν™•μΈ:**
1. μ½μ†”μ—μ„ RTT(Round Trip Time) λ΅κ·Έ ν™•μΈ
2. λ΅μ»¬ ν…μ¤νΈμΈμ§€ ν™•μΈ (μΈν„°λ„·μ„ ν†µν• ν…μ¤νΈλ” μ§€μ—° λ¶κ°€ν”Ό)
3. NetworkManager β†’ Log Levelμ„ "Developer"λ΅ μ„¤μ •ν•΄μ„ μƒμ„Έ λ΅κ·Έ ν™•μΈ

---

## μ°Έκ³  μλ£

- [Unity Netcode - Client-Side Prediction](https://docs-multiplayer.unity3d.com/netcode/current/learn/clientside-prediction/)
- [Unity Netcode - NetworkTransform](https://docs-multiplayer.unity3d.com/netcode/current/components/networktransform/)
- [Game Networking - Client-Side Prediction](https://www.gabrielgambetta.com/client-side-prediction-server-reconciliation.html)

---

## μ”μ•½

**μ΄μ „:** ν΄λΌμ΄μ–ΈνΈ μ…λ ¥ β†’ μ„λ²„ β†’ μ‘λ‹µ λ€κΈ° β†’ μ›€μ§μ„ (λλ¦Ό)
**ν„μ¬:** ν΄λΌμ΄μ–ΈνΈ μ…λ ¥ β†’ μ¦‰μ‹ μ›€μ§μ„ + μ„λ²„ κ²€μ¦ (λΉ λ¦„)

μ΄μ  ν΄λΌμ΄μ–ΈνΈλ„ νΈμ¤νΈμ™€ λ™μΌν• μ¦‰κ°μ μΈ μ΅°μ‘κ°μ„ κ°€μ§‘λ‹λ‹¤! π®
